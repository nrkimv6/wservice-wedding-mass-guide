# 모드 B: 긴 계획 (읽기 부담스러운 분량)

plan 문서는 **분석 + 근거**만 남기고, **별도 TODO 파일을 생성**한다.

## 판단 기준

- Phase 5개 이상, 원자 작업 21개 이상
- "이 문서를 처음 보는 사람이 한 번에 읽기 부담스러운가?" → 맞으면 모드 B

## ⚠️ 상태헤더 규칙

> 아래 4줄 `>` 블록쿼트를 **정확히** 따를 것. 순서·형식 변경 금지.
> 이 형식 외의 헤더(한줄, 대시 등)는 사용하지 않는다.

## Plan 문서 템플릿 (분석용)

```markdown
# {제목}

> 작성일: YYYY-MM-DD
> 대상 프로젝트: {project-name | 공통}
> 상태: 초안
> 진행률: 0/N (0%)
>
> **실행 TODO:**
> - [{제목} TODO](./{날짜}_{주제}_todo.md)
> (또는 복수 파일일 때)
> - [Phase 1-2: {이름}](./{날짜}_{주제}_todo-1.md)
> - [Phase 3-4: {이름}](./{날짜}_{주제}_todo-2.md)

---

## 개요

{배경 및 목적 설명}

## 구현 항목

| 우선순위 | 항목 | 설명 | 난이도 |
|:-------:|------|------|:------:|
| P0 | {항목1} | {설명} | 낮음/중간/높음 |

## 기술적 고려사항

- {고려사항}

---

*상태: 초안 | 진행률: 0/N (0%)*
```

## TODO 파일 템플릿 (실행용)

**프로젝트가 정해진 경우:** `{project}/docs/plan/`에 생성
**공통/복수 프로젝트:** plan은 `common/docs/plan/`에, **TODO는 각 프로젝트별로 분리 생성**

같은 폴더에 `_todo` 접미사로 생성. 이 파일만 읽으면 바로 작업 가능해야 한다.

**단일 파일** (`{날짜}_{주제}_todo.md`):

```markdown
# {제목} — TODO

> 계획서: [plan](../archive/{날짜}_{주제}.md)
> 대상 프로젝트: {project-name}
> 진행률: 0/N (0%)

## Phase 1: {이름}

1. [ ] **{상위 작업}** — 개념적 단위
   - [ ] `{파일}`: {구체적 변경 내용}
   - [ ] `{파일}`: {구체적 변경 내용}

## Phase 2: {이름}

2. [ ] **{상위 작업}** — 개념적 단위
   - [ ] `{파일}`: {구체적 변경 내용}
   - [ ] `{파일}`: {구체적 변경 내용}

---

## 백엔드/Python 변경 시 테스트 필수 규칙

백엔드 API 또는 Python 스크립트 수정이 포함된 Phase가 있으면:

1. **함수별 2레벨 TC TODO** 필수 추가:
   - [ ] `function_name()` 구현
     - [ ] 구현: {핵심 로직 설명}
     - [ ] TC-Right: 정상 케이스
     - [ ] TC-Boundary: 경계값/빈값
     - [ ] TC-Error: 에러/예외 케이스
     - [ ] TC-Cross: 교차 검증 (해당 시)

2. **e2e HTTP 테스트** 항목 필수:
   - [ ] e2e: `{METHOD} {endpoint}` 정상 응답 검증
   - [ ] e2e: `{METHOD} {endpoint}` 에러 응답 검증

기존 프로젝트 테스트 패턴(pytest, fixtures 등)을 따를 것.

---

## 검증 (Python 코드 수정 시 필수)

### 테스트 실행

\```powershell
python -m pytest {테스트 경로} -v --timeout=30
\```

- 기대 결과: {N} passed, 실행시간 < {M}초

### 회귀 확인

\```powershell
python -m pytest {전체 테스트 경로} -v --timeout=30 --ignore={신규 테스트}
\```

### 검증 기준

- [ ] 새 테스트 전부 passed
- [ ] 기존 테스트 회귀 없음
- [ ] {프로젝트별 추가 기준}

---

*진행률: 0/N (0%)*
```

**복수 파일** (Phase가 많거나 독립적인 작업 묶음):

`_todo-1.md`, `_todo-2.md` 등으로 분리. 각 파일에 plan archive 역참조 포함.

---

## 출력 단계 (원자적 — 반드시 세 작업을 연속 실행)

> **이 세 작업은 하나의 단위다. 하나라도 빠지면 미완성.**

### 1. TODO 파일 생성
- 위 템플릿으로 `plan/` 폴더에 `_todo.md` (또는 `_todo-N.md`) 생성

### 2. Plan → Archive 이동 (즉시)
- TODO 파일 생성 **직후** plan 문서를 archive로 이동:
  - 프로젝트별: `{project}/docs/plan/{파일}.md` → `{project}/docs/archive/{파일}.md`
  - 공통: `common/docs/plan/{파일}.md` → `common/docs/archive/{파일}.md`
- plan 헤더에 진행상태 수정 : `아카이브됨({todo 파일명})`
- **TODO 파일은 이동하지 않는다** — plan 폴더에 활성 상태로 유지

### 3. TODO 역참조 경로 확인
- TODO 파일의 `계획서:` 링크가 archive 경로를 가리키는지 확인
- 예: `> 계획서: [plan](../archive/2026-02-05_{주제}.md)`

---

## 후속 처리

1. `{project}/TODO.md` Pending에 참조 항목 추가:
   ```
   - [ ] **{제목}** — [todo]({TODO파일 상대경로}) (0/N, 0%)
   ```
2. SKILL.md 4단계(wtools/TODO.md 동기화)로 복귀
