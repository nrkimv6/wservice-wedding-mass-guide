---
description: "다음 작업 자동 선택 및 즉시 구현. Use when: 뭐 할까, 다음, 시작, next, what's next"
---

# 다음 작업 자동 선택

TODO, plan, 개선 아이디어에서 다음 작업을 찾아 즉시 구현을 시작합니다.

## 작업 소스 스캔 순서

1. **TODO In Progress** - 이미 진행 중인 작업 (최우선)
2. **TODO Pending** - 대기 중인 작업
3. **Plan 문서** - `common/docs/plan/*.md` 및 연결된 `_todo.md`
4. **개선 아이디어** - `common/docs/*improvement*.md` (P0 → P1 순)

## 스캔 범위 옵션

명령에 따라 스캔 범위를 동적으로 조절합니다.
- `/next`: 주로 현재 진행하던 대상과 wtools의 루트 경로 위주 기본 경량 스캔.
- `/next --all`: 5종의 전체 프로젝트 및 전역 plan 폴더 등 모든 영역 조사. (Agent 자동 모드 시 활성화 기본값)

## 충돌 방지 메커니즘

복수 Agent나 작업자가 동시에 병합되는 것을 피하기 위해 워커 할당 정책을 구사합니다.
- WORKER-ID 부여: 시스템상 현재 세션 ID 기반 (`$env:COMPUTERNAME/$project@MMdd-HHmm` 등) 이름 생성.
- 타깃 작업의 체크박스인 `[ ]`를 `[→WORKER-ID]` 로 치환하여 점유합니다.
- Git 동기화를 통해 파일 점유를 공표합니다.

**Stale 판단 규칙:**
ID 점유 후 시작시간 기준 6시간이 초과되어도 `[x]` 변환 처리가 되지 않은 채로 남겨진 항목은 `[ ]`로 자동 환원(해제)시킵니다.

## 스캔 제외 대상

다음 파일이나 상태, 항목들은 배제하여 자동으로 선택되지 않도록 합니다:
- `MANUAL_TASKS.md` : 완전 제외. 내용 전체.
- 항목명 옆에 `(→ MANUAL_TASKS)` 플래그가 붙은 라인.
- 문서 상단 *상태*에 `구현완료` 혹은 `보류` 명시가 있는 문서 전체.

## Workflow

### 0단계: wtools/TODO.md 최신 여부 확인
프로젝트 본 단위 스캔 이전에, 우선 `wtools/TODO.md` 파일에 기록된 날짜를 확인합니다. 만약 오늘의 날짜가 아닐 경우 내용 갱신을 선결 조건으로 실시한 뒤 다음 스캔을 속행합니다.

### 1단계: 작업 소스 스캔

**스캔 대상:**
```
D:\work\project\service\wtools\
├── {project}/TODO.md              # 5개 프로젝트
├── common/docs/plan/*.md          # 계획 문서 + _todo.md
└── common/docs/*improvement*.md   # 개선 아이디어
```

**TODO.md 확인:**
- `## In Progress` 섹션 → 해당 작업 계속
- `## Pending` 섹션 → 첫 번째 항목 선택

**Plan 문서 (및 `_todo.md`) 확인:**
- `[ ]` 또는 `[→TODO]` 상태 항목 찾기 (구현완료, 보류 스킵)
- 충돌 방지 절차에 따라 `[→WORKER-ID]`로 할당

**개선 아이디어 확인:**
- `완료` 표시 없는 P0 → P1 순으로 선택

### 2단계: 작업 선택 출력

```
📋 다음 작업 선택됨

소스: {소스 파일}
프로젝트: {프로젝트명}
작업: {작업 내용}
우선순위: {P0/P1/P2}
점유(WORKER-ID): {할당된 세션 ID}

→ 구현 시작합니다...
```

### 3단계: implement 워크플로우로 전환

작업이 선택되면 **즉시 `/implement` 워크플로우를 따르십시오.**
단순히 코드를 작성하지 말고, 반드시 아래 절차를 준수해야 합니다:

1. `.agent/workflows/implement.md` 파일을 읽습니다 (이미 알고 있다면 생략 가능).
2. 선택된 작업을 해당 워크플로우의 입력으로 사용하여 **plan → TODO → DONE** 사이클을 엄격히 실행합니다.
3. 작업 완료 후에는 커밋까지 완료합니다.

## 선택 우선순위

```
TODO In Progress > TODO Pending > Plan 문서 > 개선 아이디어(P0) > 개선 아이디어(P1)
```

## 할 일 없을 때

```
✅ 현재 할 일이 없습니다!

다음 중 하나를 해보세요:
1. common/docs/plan/에 새 계획 문서 작성
2. 프로젝트 TODO.md에 작업 추가
3. common/docs/*improvement*.md 검토
```

## 주의사항

- 구현 완료 시 빌드 에러 없는지 확인
- 포트/프로세스 강제 종료 금지
